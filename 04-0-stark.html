<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>STARK - zero knowledge classes</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="01.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="02-0-start.html"><strong aria-hidden="true">2.</strong> Getting Started with Circom</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="02-1-circomlib.html"><strong aria-hidden="true">2.1.</strong> Circom libraries</a></li></ol></li><li class="chapter-item expanded "><a href="03-0-merkle.html"><strong aria-hidden="true">3.</strong> Merkle for Privacy</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="03-1-hash.html"><strong aria-hidden="true">3.1.</strong> Hash functions benchmarking</a></li></ol></li><li class="chapter-item expanded "><a href="04-0-stark.html" class="active"><strong aria-hidden="true">4.</strong> STARK</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">zero knowledge classes</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="stark"><a class="header" href="#stark">STARK</a></h1>
<p>Two of the most compelling zero-knowledge technologies in the market today are zk-STARKs and zk-SNARKs. What are the differences between them? The T and the N, <code>Scalable Transparent</code> and <code>Succinct Non-interactive</code>, respectively.</p>
<p>STARK is mostly utilized by STARKWARE, for app specific rollups STARKEx and recently for StarkNet, a permissionless STARK-based L2 platform.</p>
<p>The importance tradeoffs between STARKs and SNARKs is: STARKs do not require a trusted setup, but the proof size is much larger than SNARKs.</p>
<p><img src="https://vitalik.ca/images/plonk-files/Tradeoffs.png" alt="Tradeoffs" /></p>
<p>The diagram is taken from Vitalik's <a href="https://vitalik.ca/general/2019/09/22/plonk.html">blog post</a></p>
<h2 id="starknet-architecture"><a class="header" href="#starknet-architecture">Starknet architecture</a></h2>
<p>I am curious about how L1 smart contract verifies STARK proofs and wrote on the Starknetbook <a href="https://book.starknet.io/chapter_8/solidity_verifier.html">Verifiers in Solidity</a> but that's not even scratching the surface. The task is even more daunting when knowing that SHARP (SHARe Prover) aggregates multiple Cairo programs from different users (StarkEx, Starknet, and external users through the Cairo Playground), each containing different logic. These Cairo programs are then executed together, generating a single proof common to all the programs, it is initially sent to a STARK Verifier program written in Cairo, before sending the proof to the Solidity Verifier in Ethereum ðŸ¤¯</p>
<p><img src="./images/starknet_architecture_01.png" alt="Starknet architecture" /></p>
<p><em>So is there a way to prove and verify and single Cairo program? Yes.</em></p>
<h2 id="giza"><a class="header" href="#giza">Giza</a></h2>
<p>Giza leverages the Winterfell library to prove and verify the execution of programs running on the Cairo VM. I believe that it is being used in <a href="https://github.com/ZeroSync/ZeroSync">ZeroSync</a>, a STARK proof to sync a Bitcoin full node in an instant.</p>
<h3 id="running-an-example"><a class="header" href="#running-an-example">Running an example</a></h3>
<h3 id="cairo-vm"><a class="header" href="#cairo-vm">Cairo VM</a></h3>
<p>Cairo VM is the virtual machine for the Cairo language. The one using here is the Python version <a href="https://github.com/starkware-libs/cairo-lang">cairo-lang</a>. There is breaking change from Cairo0 to Cairo1 and the VM doesn't seem to work with Cairo1 code yet (??? or I'm wrong), so the example will use the Cairo0 code.</p>
<pre><code class="language-python">%builtins range_check

from starkware.cairo.common.bool import TRUE, FALSE
from starkware.cairo.common.alloc import alloc
from starkware.cairo.common.math import abs_value

func compare_abs_arrays{range_check_ptr: felt}(
    array_a: felt*, array_b: felt*, array_length: felt, iterator: felt
) -&gt; (r: felt) {
    if (iterator == array_length) {
        return (TRUE,);
    }
    let abs_a = abs_value(array_a[iterator]);
    let abs_b = abs_value(array_b[iterator]);
    if (abs_a != abs_b) {
        return (FALSE,);
    }
    return compare_abs_arrays(array_a, array_b, array_length, iterator + 1);
}

func fill_array(array: felt*, base: felt, step: felt, array_length: felt, iterator: felt) {
    if (iterator == array_length) {
        return ();
    }
    assert array[iterator] = base + step * iterator;
    return fill_array(array, base, step, array_length, iterator + 1);
}

func main{range_check_ptr: felt}() {
    alloc_locals;
    tempvar array_length = 10;
    let (array_a: felt*) = alloc();

    let (array_b: felt*) = alloc();
    fill_array(array_a, -7, -3, array_length, 0);
    fill_array(array_b, 7, 3, array_length, 0);
    let result: felt = compare_abs_arrays(array_a, array_b, array_length, 0);
    assert result = TRUE;
    return ();
}

</code></pre>
<ul>
<li>
<p>Pseudo code:</p>
<ul>
<li>
<p>Generates 2 arrays, <code>array_a</code> and <code>array_b</code>, with the same length and the same values, but with different signs.</p>
</li>
<li>
<p>Compares the absolute values of the elements of the arrays and returns <code>TRUE</code> if they are equal.</p>
</li>
<li>
<p>We want to prove that the execution of the Cairo program was done correctly and the main function returns <code>TRUE</code>.</p>
</li>
</ul>
</li>
<li>
<p>Install the Cairo VM:</p>
</li>
</ul>
<pre><code class="language-bash">cd code/stark/cairo-example
python -m venv cairo-vm-venv
source cairo-vm-venv/bin/activate
pip install cairo-lang
</code></pre>
<p>To make sure that the Cairo VM is installed correctly and we are using the right binary, run <code>which cairo-compile</code>. It should return the path to the Cairo VM binary <code>...cairo-example/cairo-vm-venv/bin/cairo-compile</code></p>
<ul>
<li>Compile the Cairo program:</li>
</ul>
<pre><code class="language-bash">cairo-compile abs_value_array/abs_value_array.cairo --output abs_value_array/abs_value_array.json
</code></pre>
<ul>
<li>Run the program and generate the trace:</li>
</ul>
<pre><code class="language-bash">cairo-run --program=abs_value_array/abs_value_array.json --layout=small --memory_file=abs_value_array/memory.bin --trace_file=abs_value_array/trace.bin --print_info

# Valid choices for --layout are: 'plain', 'small', 'dex', 'recursive', 'starknet', 'recursive_large_output', 'all_solidity', 'starknet_with_keccak', 'dynamic'
Number of steps: 623 (originally, 623)
Used memory cells: 663
Register values after execution:
pc = 4:0
ap = 1:510
fp = 3:0
</code></pre>
<ul>
<li>Copy the example files to the Giza directory:</li>
</ul>
<pre><code class="language-bash">cp -r abs_value_array ../giza/tmp
</code></pre>
<h3 id="giza-1"><a class="header" href="#giza-1">Giza</a></h3>
<ul>
<li>Install the Giza CLI:</li>
</ul>
<pre><code class="language-bash">cd ../giza
cargo install --path cli
</code></pre>
<ul>
<li>Generate the proof:</li>
</ul>
<pre><code class="language-bash">giza prove --trace=tmp/abs_value_array/trace.bin --memory=tmp/abs_value_array/memory.bin --program=tmp/abs_value_array/abs_value_array.json --output=tmp/abs_value_array/output.bin

Built domain of 2^12 elements in 0 ms
Evaluated constraints over domain of 2^12 elements in 42 ms
Converted constraint evaluations into 4 composition polynomial columns of degree 1023 in 4 ms
Built DEEP composition polynomial of degree 1023 in 18 ms
Computed 3 FRI layers from composition polynomial evaluations in 169 ms
Determined 54 query positions in 1423 ms
Built proof object in 0 ms
Proof size: 166.0 KB
</code></pre>
<p><strong>Proof size: 166.0 KB</strong></p>
<ul>
<li>Verify the proof:</li>
</ul>
<pre><code class="language-bash">giza verify --proof=tmp/abs_value_array/output.bin
Execution verified
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="03-1-hash.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="03-1-hash.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
