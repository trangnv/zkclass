<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>zero knowledge classes</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="01.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="02-0-start.html"><strong aria-hidden="true">2.</strong> Getting Started with Circom</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="02-1-circomlib.html"><strong aria-hidden="true">2.1.</strong> Circom libraries</a></li></ol></li><li class="chapter-item expanded "><a href="03-0-merkle.html"><strong aria-hidden="true">3.</strong> Merkle for Privacy</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="03-1-hash.html"><strong aria-hidden="true">3.1.</strong> Hash functions benchmarking</a></li></ol></li><li class="chapter-item expanded "><a href="04-0-stark.html"><strong aria-hidden="true">4.</strong> STARK</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">zero knowledge classes</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Learning zkp with contents base on:</p>
<ul>
<li><a href="https://zku.gnomio.com/course/view.php?id=8">Zero-Knowledge University</a></li>
<li><a href="https://github.com/maxgillett/giza">Giza - A Cairo VM prover implemented using Winterfell</a></li>
<li><a href="https://learn.0xparc.org/">learn.0xparc</a></li>
</ul>
<p>Source code, including this book, is available at <a href="https://github.com/trangnv/zkclass">github.com/trangnv/zkclass</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started-with-circom"><a class="header" href="#getting-started-with-circom">Getting started with circom</a></h1>
<p><a href="https://docs.circom.io/getting-started/installation/">Circom</a>: Circuit Compiler</p>
<h2 id="1-compilation"><a class="header" href="#1-compilation">1. Compilation</a></h2>
<p><code>hello_world.circom</code>: the simple circuit that checks that <code>c</code> is the multiplication of <code>a</code> and <code>b</code>.</p>
<pre><code class="language-js">pragma circom 2.0.0;

/*This circuit template checks that c is the multiplication of a and b.*/

template Multiplier2 () {

   // Declaration of signals.
   signal input a;
   signal input b;
   signal output c;

   // Constraints.
   c &lt;== a * b;
}

component main = Multiplier2();
</code></pre>
<p>To compile:</p>
<pre><code class="language-bash">cd code/week1/circuits
circom hello_world.circom --r1cs --wasm --sym -o hello_world
</code></pre>
<p>That will generate</p>
<ul>
<li><code>hello_world.r1cs</code> contains the constraints of the circuit in binary format, it's like a representation of the circuit.</li>
<li><code>hello_world.sym</code></li>
<li><code>hello_world_js</code> dir contains Wasm code and other files needed to generate the witness.</li>
</ul>
<h3 id="r1cs-info"><a class="header" href="#r1cs-info">R1CS info</a></h3>
<p>To print the R1CS info, run the following command:</p>
<pre><code class="language-bash">snarkjs r1cs info hello_world/hello_world.r1cs

[INFO]  snarkJS: Curve: bn-128
[INFO]  snarkJS: # of Wires: 4
[INFO]  snarkJS: # of Constraints: 1
[INFO]  snarkJS: # of Private Inputs: 2
[INFO]  snarkJS: # of Public Inputs: 0
[INFO]  snarkJS: # of Labels: 4
[INFO]  snarkJS: # of Outputs: 1
</code></pre>
<h2 id="2-trusted-setup-and-verification-key-generation-in-groth16"><a class="header" href="#2-trusted-setup-and-verification-key-generation-in-groth16">2. Trusted setup and verification key generation in Groth16</a></h2>
<h3 id="phase-1-start-a-new-powers-of-tau-ceremony"><a class="header" href="#phase-1-start-a-new-powers-of-tau-ceremony">Phase 1, start a new powers of tau ceremony</a></h3>
<pre><code class="language-bash">snarkjs powersoftau new bn128 14 pot14_0000.ptau -v
</code></pre>
<p>The parameter after <code>new</code> indicates type of curve you wish to use, in this case <code>bn128</code>. At the moment, <code>bn128</code> and <code>bls12-381</code> are supported.</p>
<p>The parameter <code>14</code> indicates the size of the ceremony, in this case is 2^14 = 16384. The maximum value supported here is 28, which means you can use snarkjs to securely generate zk-snark parameters for circuits with up to 2 ^ 28 (≈268 million) constraints.</p>
<p>But you dont usually generate this by yourself. There are a trusted setup ceremonies done by the community and ready to be used, you can find them for example <a href="https://hermez.s3-eu-west-1.amazonaws.com/powersOfTau28_hez_final_10.ptau">powersOfTau28_hez_final_10</a> or <a href="https://storage.googleapis.com/trustedsetup-a86f4.appspot.com/semaphore/semaphore_top_index.html">here</a></p>
<h3 id="phase-2"><a class="header" href="#phase-2">Phase 2</a></h3>
<p>Because Groth16 protocol requires <strong>circuit-specific</strong> setup, after having the <code>ptau</code> file, we need to run the phase 2 of the ceremony to generate the <code>final zkey</code> file.</p>
<ul>
<li>Start new zkey</li>
</ul>
<pre><code class="language-bash">snarkjs groth16 setup hello_world/hello_world.r1cs powersOfTau28_hez_final_10.ptau hello_world/circuit_0000.zkey
</code></pre>
<ul>
<li>Contribute to the phase 2 of the ceremony:</li>
</ul>
<pre><code class="language-bash">snarkjs zkey contribute hello_world/circuit_0000.zkey hello_world/circuit_final_g16.zkey --name=&quot;1st Contributor Name&quot;
</code></pre>
<ul>
<li>Get a verification key in json format</li>
</ul>
<pre><code class="language-bash">snarkjs zkey export verificationkey hello_world/circuit_final_g16.zkey hello_world/verification_key_g16.json
</code></pre>
<ul>
<li>To see more information about the zkey file:</li>
</ul>
<pre><code class="language-bash">snarkjs zkej hello_world/circuit_final_g16.zkey hello_world/circuit_final_g16.zkey.json
</code></pre>
<h2 id="3-some-restriction-on-circom-circuits"><a class="header" href="#3-some-restriction-on-circom-circuits">3. Some restriction on circom circuits</a></h2>
<p>While circom allows writing the constraints that define the arithmetic circuit, all constraints must be quadratic of the form <code>A*B + C = 0</code>, where A, B and C are linear combinations of signals.</p>
<ul>
<li>
<p>Linear expression: an expression where only addition is used. It can also be written using multiplication of variables by constants. E.g. <code>2*x + 3*y + 2</code> is allowed, as it is equivalent to <code>x + x + y + y + y + 2</code></p>
</li>
<li>
<p>Quadratic expression: it is obtained by allowing a multiplication between two linear expressions and addition of a linear expression: A*B - C, where A, B and C are linear expressions. E.g. <code>(2*x + 3*y + 2) * (x+y) + 6\*x + y – 2</code></p>
</li>
<li>
<p>As the result, <code>c &lt;== a + b</code> is not a constraint. <code>d &lt;== a * b * c</code> is not allowed.</p>
</li>
</ul>
<h2 id="4-plonk-vs-groth16"><a class="header" href="#4-plonk-vs-groth16">4. PLONK vs Groth16</a></h2>
<ul>
<li>As oppose to Groth16, PLONK does not require <strong>circuit-specific</strong> trusted setup. Recall in Groth16, we need to run the phase 2 of the ceremony to generate the <code>final zkey</code> file, we dont need that in PLONK, we can use the same <code>universal setup</code> for all circuits. This is a huge advantage of PLONK over Groth16.</li>
</ul>
<pre><code class="language-bash"># Generate the verification key
snarkjs plonk setup hello_world/hello_world.r1cs powersOfTau28_hez_final_10.ptau hello_world/circuit_final_plonk.zkey
# Get a verification key in json format
snarkjs zkey export verificationkey hello_world/circuit_final_plonk.zkey hello_world/verification_key_plonk.json
</code></pre>
<ul>
<li>
<p>But there is a tradeoff, <strong>Proof size</strong></p>
</li>
<li>
<p>Run these commands to generate proof in Groth16 and PLONK</p>
</li>
</ul>
<p>With input <code>input.json</code>: { &quot;a&quot;: 22, &quot;b&quot;: 33 }</p>
<pre><code class="language-bash"># witness generation
node hello_world/hello_world_js/generate_witness.js hello_world/hello_world_js/hello_world.wasm hello_world/input.json hello_world/witness.wtns

# proof generation groth16
snarkjs groth16 prove hello_world/circuit_final_g16.zkey hello_world/witness.wtns hello_world/proof_g16.json hello_world/public_g16.json

# proof generation plonk
snarkjs plonk prove hello_world/circuit_final_plonk.zkey hello_world/witness.wtns hello_world/proof_plonk.json hello_world/public_plonk.json
</code></pre>
<ul>
<li><strong>Comparison</strong>: Proof size of Groth16 is 803 bytes, while PLONK is 2 KB.</li>
</ul>
<h2 id="5-testing-circuits"><a class="header" href="#5-testing-circuits">5. Testing circuits</a></h2>
<h3 id="verifying-with-snarkjs-cli"><a class="header" href="#verifying-with-snarkjs-cli">Verifying with snarkjs CLI</a></h3>
<pre><code class="language-bash">snarkjs groth16 verify hello_world/verification_key_g16.json hello_world/public_g16.json hello_world/proof_g16.json
[INFO]  snarkJS: OK!

snarkjs plonk verify hello_world/verification_key_plonk.json hello_world/public_plonk.json hello_world/proof_plonk.json
[INFO]  snarkJS: OK!
</code></pre>
<h3 id="verifying-with-smart-contract"><a class="header" href="#verifying-with-smart-contract">Verifying with smart contract</a></h3>
<p>The verifier can be a smart contract, so we can use existing framework to test the circuits.</p>
<p>To export the verifier smart contract:</p>
<pre><code class="language-bash"># groth16
snarkjs zkey export solidityverifier hello_world/circuit_final_g16.zkey ../verifier_contracts/contracts/hello_world_g16.sol
</code></pre>
<p>Now move to <code>verifier_contracts</code> dir and run some unit tests for our verifier/circuits:</p>
<pre><code class="language-bash">cd ../verifier_contracts
npm install
npx hardhat test
</code></pre>
<h3 id="running-time-of-unit-tests"><a class="header" href="#running-time-of-unit-tests">Running time of unit tests</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="circom-libraries"><a class="header" href="#circom-libraries">Circom libraries</a></h1>
<h2 id="circomlib"><a class="header" href="#circomlib">Circomlib</a></h2>
<h3 id="lessthan"><a class="header" href="#lessthan">LessThan</a></h3>
<pre><code class="language-js">pragma circom 2.0.0;
include &quot;bitify.circom&quot;;

template LessThan(n) {
    assert(n &lt;= 252);
    signal input in[2];
    signal output out;

    component n2b = Num2Bits(n+1);

    n2b.in &lt;== in[0]+ (1&lt;&lt;n) - in[1];

    out &lt;== 1-n2b.out[n];
}
</code></pre>
<p>Walk through the circuit and understand how it works, with <code>n = 32, in[0] = 2, and in[1] = 3</code></p>
<ul>
<li>
<p>The <code>assert(n &lt;= 252)</code> condition is satisfied because n = 32 &lt; 252</p>
</li>
<li>
<p><code>in[0] + (1&lt;&lt;n) - in[1] = 2 + (1&lt;&lt;32) - 3</code> = <code>(2 + 4294967296 - 3)</code> = <code>4294967295</code></p>
<ul>
<li><code>1&lt;&lt;n</code>: represents a bitwise left shift operation, where 1 is shifted n positions to the left. E.g. 1 &lt;&lt; 3 = 1000 in binary</li>
</ul>
</li>
<li>
<p><code>component n2b = Num2Bits(33)</code></p>
<ul>
<li>n2b.in = 4294967295</li>
<li>n2b.out is the 33 bits binary representation of 429496729</li>
</ul>
</li>
<li>
<p><code>out &lt;== 1-n2b.out[n];</code> output of the circuit is the last bit of n2b.out, which is 0 if in[0] &lt; in[1], otherwise 1.</p>
</li>
</ul>
<h2 id="circomlib-matrix-with-puzzle"><a class="header" href="#circomlib-matrix-with-puzzle"><a href="https://github.com/socathie/circomlib-matrix">circomlib-matrix</a> with puzzle</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h1 id="merkle-for-privacy"><a class="header" href="#merkle-for-privacy">Merkle for Privacy</a></h1>
<p><em>prove that you are a member of a group without revealing your identity</em></p>
<p><a href="">The circuit</a> uses Merkle Proof as Proof of Membership. Each group is represented by a Merkle root. A member of the group can prove that he is a member of the group by providing a Merkle Proof. I.e. he knows the leaf, the pathIndices and the siblings that lead to the <em>public</em> Merkle root, without revealing the leaf.</p>
<pre><code class="language-js">template MerkleTreeInclusionProof(nLevels) {
    signal input leaf;
    signal input pathIndices[nLevels];
    signal input siblings[nLevels];

    signal input root;

    component poseidons[nLevels];
    component mux[nLevels];

    signal hashes[nLevels + 1];
    hashes[0] &lt;== leaf;

    for (var i = 0; i &lt; nLevels; i++) {
        pathIndices[i] * (1 - pathIndices[i]) === 0;

        poseidons[i] = Poseidon(2);
        mux[i] = MultiMux1(2);

        mux[i].c[0][0] &lt;== hashes[i];
        mux[i].c[0][1] &lt;== siblings[i];

        mux[i].c[1][0] &lt;== siblings[i];
        mux[i].c[1][1] &lt;== hashes[i];

        mux[i].s &lt;== pathIndices[i];

        poseidons[i].inputs[0] &lt;== mux[i].out[0];
        poseidons[i].inputs[1] &lt;== mux[i].out[1];

        hashes[i + 1] &lt;== poseidons[i].out;
    }

    root === hashes[nLevels];
}
</code></pre>
<h2 id="merkle-trees"><a class="header" href="#merkle-trees">Merkle Trees</a></h2>
<ul>
<li>
<p>Hash function is Poseidon which is included in circomlib</p>
</li>
<li>
<p><code>nLevels</code> is the number of levels in the tree, or the depth of the tree. The number of <code>leaves = 2^nLevels</code></p>
</li>
<li>
<p><code>leaf</code> is the hash of the original data</p>
</li>
<li>
<p><code>pathIndices</code> is the position of the leaf in the tree, an array with <code>nLevels</code> length, each element is either 0 or 1</p>
</li>
<li>
<p><code>siblings</code> is the hashes of the nodes on the path from the leaf to the root. The number of <code>siblings</code> = <code>nLevels</code></p>
</li>
<li>
<p>Given the <code>leaf</code>, the <code>pathIndices</code> and the <code>siblings</code>, the circuit whould be able to compute the root</p>
</li>
</ul>
<p><img src="images/merkle_tree1.png" alt="Merkle tree" title="Merkle tree" /></p>
<p>An example: tree with depth = 3, for leaf H(E), <code>pathIndices</code> is [0,0,1] and <code>siblings</code> is [H(F), H(GH), H(ABCD)]</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hash-functions-benchmarking"><a class="header" href="#hash-functions-benchmarking">Hash functions benchmarking</a></h1>
<p><em>Some hash functions are more SNARK friendly than others, but</em></p>
<ul>
<li><a href="https://github.com/trangnv/zkclass/tree/main/code/zku/week2/circuits">Implementations</a> of hash functions written in circom, including: keccak, mimc, pedersen, poseidon, sha256.</li>
</ul>
<div class="table-wrapper"><table><thead><tr><th></th><th>keccak</th><th>sha256</th><th>pedersen</th><th>mimc</th><th>poseidon</th></tr></thead><tbody>
<tr><td># of constraints</td><td>151357</td><td>29891</td><td>964</td><td>660</td><td>213</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="stark"><a class="header" href="#stark">STARK</a></h1>
<p>Two of the most compelling zero-knowledge technologies in the market today are zk-STARKs and zk-SNARKs. What are the differences between them? The T and the N, <code>Scalable Transparent</code> and <code>Succinct Non-interactive</code>, respectively.</p>
<p>STARK is mostly utilized by STARKWARE, for app specific rollups STARKEx and recently for StarkNet, a permissionless STARK-based L2 platform.</p>
<p>The importance tradeoffs between STARKs and SNARKs is: STARKs do not require a trusted setup, but the proof size is much larger than SNARKs.</p>
<p><img src="https://vitalik.ca/images/plonk-files/Tradeoffs.png" alt="Tradeoffs" /></p>
<p>The diagram is taken from Vitalik's <a href="https://vitalik.ca/general/2019/09/22/plonk.html">blog post</a></p>
<h2 id="starknet-architecture"><a class="header" href="#starknet-architecture">Starknet architecture</a></h2>
<p>I am curious about how L1 smart contract verifies STARK proofs and wrote on the Starknetbook <a href="https://book.starknet.io/chapter_8/solidity_verifier.html">Verifiers in Solidity</a> but that's not even scratching the surface. The task is even more daunting when knowing that SHARP (SHARe Prover) aggregates multiple Cairo programs from different users (StarkEx, Starknet, and external users through the Cairo Playground), each containing different logic. These Cairo programs are then executed together, generating a single proof common to all the programs, it is initially sent to a STARK Verifier program written in Cairo, before sending the proof to the Solidity Verifier in Ethereum 🤯</p>
<p><img src="./images/starknet_architecture_01.png" alt="Starknet architecture" /></p>
<p><em>So is there a way to prove and verify and single Cairo program? Yes.</em></p>
<h2 id="giza"><a class="header" href="#giza">Giza</a></h2>
<p>Giza leverages the Winterfell library to prove and verify the execution of programs running on the Cairo VM. I believe that it is being used in <a href="https://github.com/ZeroSync/ZeroSync">ZeroSync</a>, a STARK proof to sync a Bitcoin full node in an instant.</p>
<h3 id="running-an-example"><a class="header" href="#running-an-example">Running an example</a></h3>
<h3 id="cairo-vm"><a class="header" href="#cairo-vm">Cairo VM</a></h3>
<p>Cairo VM is the virtual machine for the Cairo language. The one using here is the Python version <a href="https://github.com/starkware-libs/cairo-lang">cairo-lang</a>. There is breaking change from Cairo0 to Cairo1 and the VM doesn't seem to work with Cairo1 code yet (??? or I'm wrong), so the example will use the Cairo0 code.</p>
<pre><code class="language-python">%builtins range_check

from starkware.cairo.common.bool import TRUE, FALSE
from starkware.cairo.common.alloc import alloc
from starkware.cairo.common.math import abs_value

func compare_abs_arrays{range_check_ptr: felt}(
    array_a: felt*, array_b: felt*, array_length: felt, iterator: felt
) -&gt; (r: felt) {
    if (iterator == array_length) {
        return (TRUE,);
    }
    let abs_a = abs_value(array_a[iterator]);
    let abs_b = abs_value(array_b[iterator]);
    if (abs_a != abs_b) {
        return (FALSE,);
    }
    return compare_abs_arrays(array_a, array_b, array_length, iterator + 1);
}

func fill_array(array: felt*, base: felt, step: felt, array_length: felt, iterator: felt) {
    if (iterator == array_length) {
        return ();
    }
    assert array[iterator] = base + step * iterator;
    return fill_array(array, base, step, array_length, iterator + 1);
}

func main{range_check_ptr: felt}() {
    alloc_locals;
    tempvar array_length = 10;
    let (array_a: felt*) = alloc();

    let (array_b: felt*) = alloc();
    fill_array(array_a, -7, -3, array_length, 0);
    fill_array(array_b, 7, 3, array_length, 0);
    let result: felt = compare_abs_arrays(array_a, array_b, array_length, 0);
    assert result = TRUE;
    return ();
}

</code></pre>
<ul>
<li>
<p>Pseudo code:</p>
<ul>
<li>
<p>Generates 2 arrays, <code>array_a</code> and <code>array_b</code>, with the same length and the same values, but with different signs.</p>
</li>
<li>
<p>Compares the absolute values of the elements of the arrays and returns <code>TRUE</code> if they are equal.</p>
</li>
<li>
<p>We want to prove that the execution of the Cairo program was done correctly and the main function returns <code>TRUE</code>.</p>
</li>
</ul>
</li>
<li>
<p>Install the Cairo VM:</p>
</li>
</ul>
<pre><code class="language-bash">cd code/stark/cairo-example
python -m venv cairo-vm-venv
source cairo-vm-venv/bin/activate
pip install cairo-lang
</code></pre>
<p>To make sure that the Cairo VM is installed correctly and we are using the right binary, run <code>which cairo-compile</code>. It should return the path to the Cairo VM binary <code>...cairo-example/cairo-vm-venv/bin/cairo-compile</code></p>
<ul>
<li>Compile the Cairo program:</li>
</ul>
<pre><code class="language-bash">cairo-compile abs_value_array/abs_value_array.cairo --output abs_value_array/abs_value_array.json
</code></pre>
<ul>
<li>Run the program and generate the trace:</li>
</ul>
<pre><code class="language-bash">cairo-run --program=abs_value_array/abs_value_array.json --layout=small --memory_file=abs_value_array/memory.bin --trace_file=abs_value_array/trace.bin --print_info

# Valid choices for --layout are: 'plain', 'small', 'dex', 'recursive', 'starknet', 'recursive_large_output', 'all_solidity', 'starknet_with_keccak', 'dynamic'
Number of steps: 623 (originally, 623)
Used memory cells: 663
Register values after execution:
pc = 4:0
ap = 1:510
fp = 3:0
</code></pre>
<ul>
<li>Copy the example files to the Giza directory:</li>
</ul>
<pre><code class="language-bash">cp -r abs_value_array ../giza/tmp
</code></pre>
<h3 id="giza-1"><a class="header" href="#giza-1">Giza</a></h3>
<ul>
<li>Install the Giza CLI:</li>
</ul>
<pre><code class="language-bash">cd ../giza
cargo install --path cli
</code></pre>
<ul>
<li>Generate the proof:</li>
</ul>
<pre><code class="language-bash">giza prove --trace=tmp/abs_value_array/trace.bin --memory=tmp/abs_value_array/memory.bin --program=tmp/abs_value_array/abs_value_array.json --output=tmp/abs_value_array/output.bin

Built domain of 2^12 elements in 0 ms
Evaluated constraints over domain of 2^12 elements in 42 ms
Converted constraint evaluations into 4 composition polynomial columns of degree 1023 in 4 ms
Built DEEP composition polynomial of degree 1023 in 18 ms
Computed 3 FRI layers from composition polynomial evaluations in 169 ms
Determined 54 query positions in 1423 ms
Built proof object in 0 ms
Proof size: 166.0 KB
</code></pre>
<p><strong>Proof size: 166.0 KB</strong></p>
<ul>
<li>Verify the proof:</li>
</ul>
<pre><code class="language-bash">giza verify --proof=tmp/abs_value_array/output.bin
Execution verified
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
